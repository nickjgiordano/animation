DROP TABLE IF EXISTS Watchlist, Account, Movie, Studio;

CREATE TABLE Studio(
	ID INT NOT NULL AUTO_INCREMENT,
	Studio_Name VARCHAR(70) NOT NULL,
	PRIMARY KEY (ID)
);
INSERT INTO Studio (Studio_Name) VALUES
('Walt Disney Animation Studios'),
('Pixar Animation Studios'),
('DreamWorks Animation'),
('Blue Sky Studios'),
('Illumination Entertainment'),
('Sony Pictures Animation'),
('Warner Animation Group'),
('Paramount Animation');

CREATE TABLE Movie(
	ID INT NOT NULL AUTO_INCREMENT,
	Release_Date DATE NOT NULL,
	Studio_ID INT NOT NULL,
	Movie_Title VARCHAR(70) NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (Studio_ID) REFERENCES Studio(ID)
);
ALTER TABLE Movie ADD UNIQUE INDEX (Release_Date, Movie_Title);
INSERT INTO Movie (Release_Date, Studio_ID, Movie_Title) VALUES
('1995-11-22', 2, 'Toy Story'),
('1998-10-02', 3, 'Antz'),
('1998-11-25', 2, 'A Bug\'s Life'),
('1999-11-24', 2, 'Toy Story 2'),
('2000-05-19', 1, 'Dinosaur'),
('2001-05-18', 3, 'Shrek'),
('2001-11-02', 2, 'Monsters, Inc.'),
('2002-03-15', 4, 'Ice Age'),
('2003-05-30', 2, 'Finding Nemo'),
('2004-05-19', 3, 'Shrek 2'),
('2004-10-01', 3, 'Shark Tale'),
('2004-11-05', 2, 'The Incredibles'),
('2005-03-11', 4, 'Robots'),
('2005-05-17', 3, 'Madagascar'),
('2005-11-04', 1, 'Chicken Little'),
('2006-03-31', 4, 'Ice Age: The Meltdown'),
('2006-05-19', 3, 'Over the Hedge'),
('2006-06-09', 2, 'Cars'),
('2006-09-29', 6, 'Open Season'),
('2006-11-03', 3, 'Flushed Away'),
('2007-03-30', 1, 'Meet the Robinsons'),
('2007-05-18', 3, 'Shrek the Third'),
('2007-06-08', 6, 'Surf\'s Up'),
('2007-06-29', 2, 'Ratatouille'),
('2007-11-02', 3, 'Bee Movie'),
('2008-03-14', 4, 'Horton Hears a Who!'),
('2008-06-06', 3, 'Kung Fu Panda'),
('2008-06-27', 2, 'WALL-E'),
('2008-11-07', 3, 'Madagascar: Escape 2 Africa'),
('2008-11-21', 1, 'Bolt'),
('2009-03-27', 3, 'Monsters vs. Aliens'),
('2009-05-29', 2, 'Up'),
('2009-07-01', 4, 'Ice Age: Dawn of the Dinosaurs'),
('2009-09-18', 6, 'Cloudy with a Chance of Meatballs'),
('2010-03-26', 3, 'How to Train Your Dragon'),
('2010-05-21', 3, 'Shrek Forever After'),
('2010-06-18', 2, 'Toy Story 3'),
('2010-07-09', 5, 'Despicable Me'),
('2010-11-05', 3, 'Megamind'),
('2010-11-24', 1, 'Tangled'),
('2011-04-15', 4, 'Rio'),
('2011-05-26', 3, 'Kung Fu Panda 2'),
('2011-06-24', 2, 'Cars 2'),
('2011-10-28', 3, 'Puss in Boots'),
('2011-11-23', 6, 'Arthur Christmas'),
('2012-03-02', 5, 'The Lorax'),
('2012-06-08', 3, 'Madagascar 3: Europe\'s Most Wanted'),
('2012-06-22', 2, 'Brave'),
('2012-07-13', 4, 'Ice Age: Continental Drift'),
('2012-09-28', 6, 'Hotel Transylvania'),
('2012-11-02', 1, 'Wreck-It Ralph'),
('2012-11-21', 3, 'Rise of the Guardians'),
('2013-03-22', 3, 'The Croods'),
('2013-05-24', 4, 'Epic'),
('2013-06-21', 2, 'Monsters University'),
('2013-07-02', 5, 'Despicable Me 2'),
('2013-07-17', 3, 'Turbo'),
('2013-09-27', 6, 'Cloudy with a Chance of Meatballs 2'),
('2013-11-27', 1, 'Frozen'),
('2014-02-07', 7, 'The Lego Movie'),
('2014-03-07', 3, 'Mr. Peabody & Sherman'),
('2014-04-11', 4, 'Rio 2'),
('2014-06-13', 3, 'How to Train Your Dragon 2'),
('2014-11-07', 1, 'Big Hero 6'),
('2014-11-26', 3, 'Penguins of Madagascar'),
('2015-02-06', 8, 'The SpongeBob Movie'),
('2015-03-27', 3, 'Home'),
('2015-06-19', 2, 'Inside Out'),
('2015-07-10', 5, 'Minions'),
('2015-09-25', 6, 'Hotel Transylvania 2'),
('2015-11-06', 4, 'The Peanuts Movie'),
('2015-11-25', 2, 'The Good Dinosaur'),
('2016-01-29', 3, 'Kung Fu Panda 3'),
('2016-03-04', 1, 'Zootopia'),
('2016-06-17', 2, 'Finding Dory'),
('2016-07-08', 5, 'The Secret Life of Pets'),
('2016-07-22', 4, 'Ice Age: Collision Course'),
('2016-09-23', 7, 'Storks'),
('2016-11-04', 3, 'Trolls'),
('2016-11-23', 1, 'Moana'),
('2016-12-21', 5, 'Sing'),
('2017-02-10', 7, 'The Lego Batman Movie'),
('2017-03-31', 3, 'The Boss Baby'),
('2017-04-07', 6, 'Smurfs: The Lost Village'),
('2017-06-02', 3, 'Captain Underpants'),
('2017-06-16', 2, 'Cars 3'),
('2017-06-30', 5, 'Despicable Me 3'),
('2017-07-28', 6, 'The Emoji Movie'),
('2017-09-22', 7, 'The Lego Ninjago Movie'),
('2017-11-17', 6, 'The Star'),
('2017-11-22', 2, 'Coco'),
('2017-12-15', 4, 'Ferdinand');

CREATE TABLE Account(
	ID INT NOT NULL AUTO_INCREMENT,
	Username VARCHAR(70) NOT NULL,
	Administrator BOOLEAN,
	PRIMARY KEY (ID, Username)
);
ALTER TABLE Account ADD UNIQUE INDEX (Username);
INSERT INTO Account (Username, Administrator) VALUES
('ngiordano', 1),
('crobinson', 1),
('mhair', 1),
('oosadolor', 0),
('svajkai', 0),
('agray', 0),
('sdyett', 0),
('melsoudani', 0),
('solufemi', 0),
('wstone', 0),
('jakhilomen', 0),
('groberts', 0),
('aomotunde', 1),
('dlathbridge', 1),
('tristea', 1),
('agiordano', 1),
('jgiordano', 1),
('miancu', 1);

CREATE TABLE Watchlist(
	ID INT NOT NULL AUTO_INCREMENT,
	Rating INT,
	Account_ID INT NOT NULL,
	Movie_ID INT NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (Account_ID) REFERENCES Account(ID),
	FOREIGN KEY (Movie_ID) REFERENCES Movie(ID),
	CHECK (Rating <= 5)
);
ALTER TABLE Watchlist ADD UNIQUE INDEX (Account_ID, Movie_ID);

CREATE OR REPLACE VIEW viewUnion AS
SELECT Movie_Title, Release_Date, Studio_Name, Watchlist.ID AS WatchCount,
IF(Rating = 0, NULL, Rating) AS Rating, 'yes' AS Watched,
Rating AS User_Rating, Movie.ID AS Movie_ID, Watchlist.ID AS Watchlist_ID
FROM (Movie INNER JOIN Studio ON Studio_ID = Studio.ID)
LEFT JOIN Watchlist ON Movie.ID = Movie_ID
WHERE ACCOUNT_ID = ''
UNION
SELECT Movie_Title, Release_Date, Studio_Name, IF(ACCOUNT_ID = '', NULL, Watchlist.ID),
IF(ACCOUNT_ID = '', NULL, IF(Rating = 0, NULL, Rating) ), IF(ACCOUNT_ID = '', IF(Watchlist.ID > 0, 'yes', 'no'), 'no'),
IF(ACCOUNT_ID = '', Rating, 0), Movie.ID, IF(ACCOUNT_ID = '', Watchlist.ID, 0)
FROM (Movie INNER JOIN Studio ON Studio_ID = Studio.ID)
LEFT JOIN Watchlist ON Movie.ID = Movie_ID;

CREATE OR REPLACE VIEW viewMain AS
SELECT Movie_Title, Release_Date, Studio_Name,
COUNT(WatchCount) AS Watched_by, CAST(AVG(Rating) AS INTEGER) AS Average_Rating, Watched, User_Rating, Movie_ID, Watchlist_ID
FROM viewUnion
GROUP BY Movie_ID
ORDER BY Release_Date;

CREATE OR REPLACE VIEW viewMovie AS
SELECT Movie.ID, Movie_Title, Release_Date, Studio_Name
FROM Movie INNER JOIN Studio ON Studio_ID = Studio.ID
ORDER BY ID;

CREATE OR REPLACE VIEW viewWatchlist AS
SELECT Watchlist.ID, Username, Movie_Title, CONCAT(Rating, '/5') AS Rating
FROM (Watchlist INNER JOIN Account ON Account_ID = Account.ID)
INNER JOIN Movie ON Movie_ID = Movie.ID
ORDER BY ID;

CREATE OR REPLACE VIEW formMovie AS
SELECT Movie.ID, Movie_Title, Release_Date,
CONCAT(Studio_Name, ' [', Studio.ID, ']') AS Studio_ID_fk
FROM Movie INNER JOIN Studio ON Studio_ID = Studio.ID;

CREATE OR REPLACE VIEW formWatchlist AS
SELECT Watchlist.ID,
CONCAT(Username, ' [', Account.ID, ']') AS Account_ID_fk,
CONCAT(Movie_Title, ' [', Movie.ID, ']') AS Movie_ID_fk,
Rating
FROM (Watchlist INNER JOIN Account ON Account_ID = Account.ID)
INNER JOIN Movie ON Movie_ID = Movie.ID;

CREATE OR REPLACE VIEW listStudio AS
SELECT CONCAT(Studio_Name, ' [', Studio.ID, ']') AS list
FROM Studio
ORDER BY list;

CREATE OR REPLACE VIEW listAccount AS
SELECT CONCAT(Username, ' [', Account.ID, ']') AS list
FROM Account
ORDER BY list;

CREATE OR REPLACE VIEW listMovie AS
SELECT CONCAT(Movie_Title, ' [', Movie.ID, ']') AS list
FROM Movie
ORDER BY list;

INSERT INTO Watchlist (Rating, Account_ID, Movie_ID) VALUES
(5, 1, 1),
(3, 1, 2),
(4, 1, 3),
(5, 1, 4),
(3, 1, 6),
(3, 1, 7),
(3, 1, 9),
(3, 1, 10),
(3, 1, 12),
(3, 1, 20),
(2, 1, 22),
(4, 1, 24),
(1, 1, 25),
(2, 1, 27),
(5, 1, 28),
(5, 1, 32),
(4, 1, 35),
(4, 1, 37),
(2, 1, 38),
(5, 1, 51),
(2, 1, 59),
(4, 1, 60),
(3, 1, 63),
(4, 1, 64),
(2, 1, 68),
(4, 13, 3),
(5, 13, 48),
(5, 13, 18),
(2, 13, 43),
(3, 13, 75),
(3, 13, 9),
(4, 13, 68),
(5, 13, 55),
(5, 13, 7),
(5, 13, 24),
(5, 13, 12),
(3, 13, 1),
(2, 13, 4),
(2, 13, 37),
(5, 13, 32),
(5, 13, 2),
(5, 13, 6),
(3, 13, 8),
(4, 13, 10),
(4, 13, 11),
(5, 13, 14),
(4, 13, 15),
(4, 13, 16),
(3, 13, 20),
(4, 13, 22),
(3, 13, 25),
(5, 13, 26),
(5, 13, 27),
(4, 13, 29),
(4, 13, 30),
(5, 13, 31),
(3, 13, 33),
(4, 13, 34),
(5, 13, 35),
(3, 13, 36),
(4, 13, 38),
(5, 13, 39),
(5, 13, 40),
(5, 13, 41),
(4, 13, 42),
(5, 13, 44),
(3, 13, 47),
(2, 13, 49),
(5, 13, 50),
(4, 13, 51),
(5, 13, 52),
(5, 13, 53),
(5, 13, 54),
(4, 13, 56),
(4, 13, 58),
(3, 13, 59),
(2, 13, 60),
(3, 13, 62),
(4, 13, 63),
(5, 13, 64),
(5, 13, 65),
(2, 13, 67),
(4, 13, 69),
(3, 13, 70),
(3, 13, 73),
(5, 13, 74),
(5, 13, 76),
(4, 13, 77),
(5, 13, 80),
(5, 13, 81),
(5, 13, 83),
(4, 14, 3),
(5, 14, 77),
(3, 14, 55),
(5, 14, 10),
(3, 14, 21),
(3, 14, 43),
(1, 14, 59),
(5, 14, 32),
(4, 14, 2),
(2, 14, 45),
(4, 14, 25),
(5, 14, 30),
(5, 14, 48),
(5, 14, 18),
(3, 14, 15),
(5, 14, 34),
(5, 14, 38),
(5, 14, 56),
(5, 14, 9),
(3, 14, 26),
(5, 14, 35),
(5, 14, 8),
(5, 14, 49),
(5, 14, 33),
(5, 14, 16),
(5, 14, 68),
(2, 14, 27),
(5, 14, 14),
(5, 14, 47),
(5, 14, 29),
(5, 14, 39),
(5, 14, 80),
(5, 14, 7),
(5, 14, 17),
(5, 14, 44),
(5, 14, 24),
(4, 14, 41),
(5, 14, 11),
(5, 14, 6),
(3, 14, 36),
(5, 14, 22),
(3, 14, 84),
(5, 14, 23),
(5, 14, 40),
(4, 14, 83),
(5, 14, 53),
(5, 14, 12),
(3, 14, 46),
(2, 14, 66),
(4, 14, 1),
(5, 14, 37),
(5, 14, 28),
(5, 14, 51),
(3, 15, 3),
(5, 15, 2),
(4, 15, 64),
(3, 15, 30),
(4, 15, 48),
(5, 15, 18),
(1, 15, 43),
(4, 15, 34),
(3, 15, 58),
(5, 15, 38),
(5, 15, 56),
(3, 15, 75),
(5, 15, 9),
(2, 15, 59),
(4, 15, 50),
(3, 15, 35),
(5, 15, 8),
(5, 15, 77),
(4, 15, 49),
(4, 15, 33),
(4, 15, 16),
(5, 15, 68),
(5, 15, 27),
(5, 15, 42),
(5, 15, 73),
(5, 15, 14),
(4, 15, 39),
(3, 15, 80),
(4, 15, 55),
(4, 15, 7),
(2, 15, 61),
(4, 15, 65),
(5, 15, 44),
(5, 15, 24),
(3, 15, 41),
(5, 15, 11),
(3, 15, 6),
(1, 15, 10),
(1, 15, 36),
(3, 15, 23),
(4, 15, 53),
(2, 15, 72),
(5, 15, 60),
(4, 15, 76),
(3, 15, 1),
(3, 15, 4),
(3, 15, 32),
(5, 15, 28),
(3, 15, 74),
(3, 16, 9),
(4, 16, 24),
(4, 16, 59),
(4, 16, 6),
(4, 16, 40),
(3, 16, 28),
(3, 17, 3),
(3, 17, 2),
(4, 17, 34),
(4, 17, 9),
(4, 17, 59),
(3, 17, 50),
(4, 17, 35),
(4, 17, 8),
(3, 17, 14),
(4, 17, 39),
(4, 17, 31),
(4, 17, 7),
(4, 17, 24),
(3, 17, 11),
(4, 17, 6),
(4, 17, 10),
(2, 17, 36),
(3, 17, 22),
(3, 17, 40),
(4, 17, 12),
(4, 17, 60),
(5, 17, 1),
(5, 17, 4),
(5, 17, 37),
(4, 17, 32),
(4, 17, 51),
(4, 8, 3),
(4, 8, 45),
(5, 8, 64),
(5, 8, 18),
(5, 8, 43),
(5, 8, 86),
(5, 8, 15),
(5, 8, 9),
(5, 8, 75),
(5, 8, 68),
(5, 8, 14),
(5, 8, 47),
(5, 8, 29),
(5, 8, 55),
(4, 8, 6),
(5, 8, 10),
(4, 8, 36),
(4, 8, 1),
(3, 8, 4),
(5, 8, 37),
(4, 7, 30),
(3, 7, 18),
(2, 7, 9),
(4, 7, 8),
(3, 7, 14),
(5, 7, 17),
(4, 7, 19),
(4, 7, 6),
(4, 7, 10),
(5, 7, 1),
(4, 7, 4),
(3, 7, 37),
(4, 7, 28),
(5, 7, 51),
(3, 5, 3),
(3, 5, 2),
(4, 5, 45),
(2, 5, 25),
(5, 5, 64),
(3, 5, 30),
(3, 5, 48),
(2, 5, 85),
(4, 5, 18),
(5, 5, 15),
(4, 5, 34),
(4, 5, 58),
(5, 5, 38),
(3, 5, 56),
(2, 5, 75),
(5, 5, 9),
(5, 5, 20),
(2, 5, 59),
(3, 5, 67),
(2, 5, 26),
(5, 5, 50),
(5, 5, 70),
(5, 5, 35),
(5, 5, 63),
(4, 5, 8),
(3, 5, 77),
(3, 5, 49),
(3, 5, 33),
(3, 5, 16),
(2, 5, 68),
(5, 5, 27),
(4, 5, 42),
(4, 5, 73),
(4, 5, 14),
(3, 5, 47),
(3, 5, 29),
(4, 5, 39),
(4, 5, 69),
(5, 5, 80),
(4, 5, 55),
(3, 5, 31),
(5, 5, 7),
(2, 5, 61),
(3, 5, 19),
(5, 5, 17),
(4, 5, 65),
(5, 5, 44),
(4, 5, 24),
(2, 5, 41),
(3, 5, 52),
(4, 5, 13),
(5, 5, 6),
(3, 5, 10),
(3, 5, 36),
(4, 5, 22),
(3, 5, 81),
(4, 5, 23),
(5, 5, 40),
(3, 5, 83),
(3, 5, 53),
(2, 5, 72),
(5, 5, 12),
(5, 5, 82),
(3, 5, 60),
(4, 5, 71),
(2, 5, 1),
(2, 5, 4),
(2, 5, 37),
(3, 5, 79),
(3, 5, 57),
(5, 5, 28),
(5, 5, 32),
(4, 5, 51),
(3, 5, 74),
(3, 4, 41),
(1, 18, 18),
(5, 18, 1),
(5, 18, 6),
(5, 18, 10),
(5, 18, 22),
(3, 9, 3),
(2, 9, 2),
(3, 9, 25),
(3, 9, 48),
(4, 9, 18),
(4, 9, 15),
(3, 9, 34),
(4, 9, 38),
(3, 9, 56),
(3, 9, 8),
(4, 9, 16),
(3, 9, 33),
(3, 9, 35),
(3, 9, 27),
(4, 9, 14),
(3, 9, 29),
(4, 9, 21),
(4, 9, 7),
(3, 9, 17),
(3, 9, 24),
(4, 9, 13),
(3, 9, 11),
(3, 9, 6),
(4, 9, 10),
(2, 9, 23),
(4, 9, 12),
(4, 9, 66),
(4, 9, 1),
(3, 9, 4),
(4, 9, 37),
(4, 9, 51),
(4, 6, 1),
(3, 6, 2),
(4, 6, 3),
(4, 6, 4),
(3, 6, 5),
(4, 6, 6),
(4, 6, 7),
(4, 6, 8),
(4, 6, 9),
(3, 6, 10),
(2, 6, 11),
(4, 6, 12),
(2, 6, 13),
(4, 6, 14),
(2, 6, 15),
(3, 6, 16),
(2, 6, 17),
(3, 6, 18),
(3, 6, 19),
(3, 6, 20),
(2, 6, 21),
(3, 6, 22),
(2, 6, 23),
(2, 6, 24),
(1, 6, 25),
(3, 6, 27),
(5, 6, 28),
(3, 6, 29),
(2, 6, 30),
(3, 6, 33),
(2, 6, 34),
(5, 6, 35),
(2, 6, 36),
(2, 6, 37),
(3, 6, 38),
(3, 6, 40),
(3, 6, 42),
(3, 6, 43),
(4, 6, 44),
(3, 6, 47),
(4, 6, 48),
(2, 6, 49),
(5, 6, 51),
(4, 6, 52),
(3, 6, 53),
(3, 6, 55),
(3, 6, 59),
(5, 6, 60),
(4, 6, 63),
(5, 6, 64),
(3, 6, 65),
(1, 6, 66),
(5, 6, 68),
(2, 6, 69),
(3, 6, 73),
(3, 6, 75),
(2, 6, 76),
(2, 6, 77),
(2, 6, 86),
(4, 9, 9);